{% extends "/admin/layout/index.html" %}

{% block content %}
<!-- CSS -->
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/datajumbotron.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.21.2/dist/extensions/export/bootstrap-table-export.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script src="https://rawgit.com/hhurz/tableExport.jquery.plugin/master/tableExport.min.js"></script>

<div class="jumbotron-container">
  <div class="jumbotron-title">
    <i class="uil uil-image-v"></i>
    <span>Kelola Jumbotron Images</span>
  </div>

  <!-- Form Upload -->
  <div class="activity mb-4">
    <form class="activity-form" action="{{ url_for('upload_jumbotron_image') }}" method="POST" enctype="multipart/form-data">
      <div class="form-group mb-3">
        <label for="image"><strong>Unggah Gambar Baru</strong></label>
        <input type="file" id="image" name="image" accept="image/*" required>
      </div>
      <div class="jumbotron-button-container">
        <button type="submit" class="jumbotron-add-btn">
          <i class="fa fa-upload"></i> Unggah
        </button>
      </div>
    </form>
  </div>

  <!-- Tabel Gambar -->
  <div class="table-responsive">
    <table id="tableJumbotron" 
           class="table table-jumbotron"
           data-toggle="table"
           data-toolbar="#toolbar"
           data-search="true"
           data-show-columns="true"
           data-show-refresh="true"
           data-pagination="true"
           data-page-list="[5, 10, 20, 50, 100]"
           data-show-export="true"
           data-export-types="['excel','csv','pdf']"
           data-export-options='{"fileName": "data-jumbotron"}'
           data-pagination-pre-text="‹"
           data-pagination-next-text="›">
      <thead class="thead-dark">
        <tr>
          <th data-field="no" data-sortable="true">No</th>
          <th data-field="gambar">Gambar</th>
          <th data-field="aksi">Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for img in images %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>
            <img src="{{ url_for('static', filename='img/' + img.filename) }}" alt="Jumbotron Image" class="table-img">
          </td>
          <td>
            <div class="jumbotron-action-buttons">
              <form action="{{ url_for('delete_jumbotron_image', id=img.id) }}" method="POST" style="display:inline;">
                <button type="button" class="jumbotron-btn-circle delete delete-btn-confirm" title="Hapus">
                  <i class="fa fa-trash"></i>
                </button>
              </form>
            </div>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="3" class="text-center text-muted">Belum ada gambar jumbotron yang diunggah.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- JS Interaktif -->
<script>
  // Upload Gambar
  $('form.activity-form').on('submit', function (e) {
    e.preventDefault();
    const form = $(this)[0];
    const formData = new FormData(form);

    $.ajax({
      url: $(this).attr('action'),
      type: 'POST',
      data: formData,
      contentType: false,
      processData: false,
      success: function () {
        Swal.fire({
          icon: 'success',
          title: 'Berhasil!',
          text: 'Gambar jumbotron berhasil diunggah.',
          timer: 2000,
          showConfirmButton: false
        }).then(() => location.reload());
      },
      error: function () {
        Swal.fire({
          icon: 'error',
          title: 'Gagal!',
          text: 'Terjadi kesalahan saat mengunggah gambar.'
        });
      }
    });
  });

  // Hapus Gambar
  $(document).on('click', '.delete-btn-confirm', function (e) {
    e.preventDefault();
    const form = $(this).closest('form');
    const actionUrl = form.attr('action');

    Swal.fire({
      title: 'Apakah Anda yakin?',
      text: 'Gambar ini akan dihapus secara permanen!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: 'Ya, hapus!',
      cancelButtonText: 'Batal',
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33'
    }).then((result) => {
      if (result.isConfirmed) {
        $.post(actionUrl)
          .done(() => {
            Swal.fire({
              icon: 'success',
              title: 'Berhasil!',
              text: 'Gambar berhasil dihapus.',
              timer: 2000,
              showConfirmButton: false
            }).then(() => location.reload());
          })
          .fail(() => {
            Swal.fire({
              icon: 'error',
              title: 'Gagal!',
              text: 'Terjadi kesalahan saat menghapus gambar.'
            });
          });
      }
    });
  });
</script>
{% endblock %}
